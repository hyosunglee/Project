# 코드 구현 점검 보고서

본 문서는 현재 리포지토리에 포함된 자동 수집/학습/예측 파이프라인 코드가 목표 기능을 충실히 구현하고 있는지 검토한 내용입니다.

## 종합 평가
- API와 스케줄링 골격은 존재하지만, **학습 완료 후 자동 예측 트리거가 구현되어 있지 않고**, 스케줄러에서도 학습 결과 기록이나 후속 작업 연결이 누락되어 있습니다.
- 예측/학습 함수들은 기본 동작을 수행하나, 데이터 품질 부족 시 `None` 반환 이후 처리, 결과 로그 관리, 중복 예측 방지 등 운영 단계에서 필요한 보조 로직이 비어 있습니다.

## 세부 점검

### 1) 학습 트리거와 스케줄링
- `/train` 엔드포인트는 백그라운드 스레드에서 `train_model()`만 호출하고 종료하며, 학습 완료 후 예측을 호출하거나 추가 작업을 연결하는 로직이 없습니다.【F:server.py†L138-L149】
- APScheduler의 `scheduled_train` 작업 역시 `train_model()`만 실행하고 반환값(메트릭)을 버려 결과 저장이나 후속 예측을 수행하지 않습니다.【F:server.py†L174-L225】
- 스케줄러에 예측 작업(`scheduled_predict`)이 존재하지 않아 주기적 예측이 전혀 실행되지 않습니다.【F:server.py†L174-L225】

### 2) 예측 API와 모델 로딩
- `/predict` 라우트는 요청 시점에만 실행되며, 자동 호출 경로가 없습니다. 입력 검증 후 `predict_reward()` 결과를 파일로 저장하지만, 중복 예측 방지나 추적 정보는 포함되지 않습니다.【F:api_predict.py†L15-L35】
- `predict_reward()`는 `reward_latest.pkl` 심볼릭 링크에 의존해 모델을 로드합니다. 링크가 없으면 API는 단순 오류 메시지만 반환하므로, 배포 직후 자동 학습/링크 생성 흐름이 필수입니다.【F:utils/predictor.py†L19-L80】

### 3) 학습 파이프라인 품질
- `train_model()`은 `logs.jsonl`과 `retrain_buffer.jsonl`을 결합해 TF-IDF + 로지스틱 회귀 모델을 학습하며, 메트릭과 모델을 저장하고 최신 모델 링크를 갱신합니다.【F:utils/trainer.py†L35-L97】
- 로그가 없거나 클래스 다양성이 부족하면 `None`을 반환하지만, 호출 측(`/train`, `scheduled_train`)에서는 이를 확인해 후속 대응을 하지 않기 때문에 운영 로그가 남지 않습니다.【F:utils/trainer.py†L35-L56】【F:server.py†L138-L149】【F:server.py†L174-L225】
- 불필요한 패키지(`numpy`, `pandas`, `make_pipeline`)가 import 되어 있으나 사용되지 않아 정리 필요성이 있습니다.【F:utils/trainer.py†L3-L12】

## 결론 및 개선 제안
- 목표인 "학습 완료 후 자동 예측" 흐름이 코드에 존재하지 않으므로, 학습 완료 시 예측 함수를 호출하거나 스케줄러에 학습 후 예측 작업을 등록하는 로직을 추가해야 합니다.
- 학습/예측 결과를 일관되게 기록하고, 데이터 부족·모델 미존재와 같은 예외 상황을 호출부에서 처리하도록 보완하면 운영 안정성이 향상됩니다.
- 불필요한 의존성 정리와 중복 예측 방지 로직(최근 로그 기반 필터링 등) 추가를 권장합니다.
